%\documentclass[prd,twocolumn,amsmath,amssymb,floatfix,superscriptaddress,nofootinbib,preprintnumbers]{revtex4-1}
\documentclass[prd,amsmath,amssymb,floatfix,superscriptaddress,nofootinbib,preprintnumbers]{revtex4-1}

\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bea{\begin{eqnarray}}
\def\eea{\end{eqnarray}}
\newcommand{\vs}{\nonumber\\}
\def\across{a^\times}
\def\tcross{T^\times}
\def\ccross{C^\times}
\newcommand{\ec}[1]{Eq.~(\ref{eq:#1})}
\newcommand{\eec}[2]{Eqs.~(\ref{eq:#1}) and (\ref{eq:#2})}
\newcommand{\Ec}[1]{(\ref{eq:#1})}
\newcommand{\eql}[1]{\label{eq:#1}}
\newcommand{\sfig}[2]{
\includegraphics[width=#2]{#1}
        }
\newcommand{\sfigr}[2]{
\includegraphics[angle=270,origin=c,width=#2]{#1}
        }
\newcommand{\sfigra}[2]{
\includegraphics[angle=90,origin=c,width=#2]{#1}
        }
\newcommand{\Sfig}[2]{
   \begin{figure}[thbp]
   \begin{center}
    \sfig{#1.pdf}{0.5\columnwidth}
    \caption{{\small #2}}
    \label{fig:#1}
     \end{center}
   \end{figure}
}
\newcommand\dirac{\delta_D}
\newcommand{\rf}[1]{\ref{fig:#1}}
\newcommand\rhoc{\rho_{\rm cr}}
\newcommand\zs{D_S}
\newcommand\dts{\Delta t_{\rm Sh}}
\newcommand\zle{D_L}
\newcommand\zsl{D_{SL}}


%USEFUL PACKAGES
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{color}
\usepackage{enumitem}
\usepackage[linktocpage=true]{hyperref} 
\hypersetup{
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=red,          % color of internal links
    citecolor=blue,        % color of links to bibliography 
    filecolor=magenta,      % color of file links
    urlcolor=blue           % color of external links
}
\usepackage[all]{hypcap} 

%USEFUL MACROS
%\usepackage{myterms}
\definecolor{darkgreen}{cmyk}{0.85,0.1,1.00,0} 

\newcommand{\SD}[1]{{\color{darkgreen} SD: #1}}
\newcommand{\WH}[1]{{\color{red} WH: #1}}
\newcommand{\wh}[1]{{\color{red} WH: #1}}
\newcommand{\AL}[1]{{\color{magenta} AL: #1}}
\newcommand{\MR}[1]{{\color{blue} MR: #1}}

\newcommand{\nl}{\\ \indent}
%

\begin{document}

\title{\Large Time Delays in the Cosmic Microwave Background}


\author{\large Scott Dodelson}
\author{\large Peikai Li}
%\email{dodelson@fnal.gov}
\affiliation{Department of Physics, Carnegie Mellon University, Pittsburgh, Pennsylvania 15312, USA.}

\date{\today}

\begin{abstract}
We consider the possibility of detecting the time delay field from cosmic microwave background experiments.
\end{abstract}

\maketitle

\section{Time Delay Estimator}

\subsection{Flat Sky Approximation} We would like to obtain an expression for the change in the observed temperature due to the time delay akin to the one used for deflection. Recall that the impact of deflection can be traced by Taylor expanding
\begin{equation}
T(\vec\theta) = T^u(\vec\theta) - \vec\alpha\cdot \frac{\partial T^u}{\partial\vec\theta}.
\end{equation}
The Fourier transform of the deflection term is then
\begin{equation}
\tilde T^\phi(\vec l) =\int \frac{d^2l'}{(2\pi)^2} \vec l'\cdot (\vec l-\vec l') \tilde\phi(\vec l') \tilde T^u(\vec l-\vec l')
\eql{tphi}\end{equation}
We want to derive a similar expression for the impact of time delay. 

A first guess at the Fourier space is
that the unlensed temperature is simply
\begin{equation}
\tilde T^u(\vec l) = \int d^2\theta e^{-i\vec l\cdot \vec\theta}\, \int \frac{d^3k}{(2\pi)^3} e^{i\vec k\cdot [\chi_*\vec\theta,\chi_*]}  [\tilde T_0+\tilde\Psi](\vec k)
\end{equation}
which uses the small sky approximation to express the position from whence the CMB photons are emitted as $[\chi_*\vec\theta,\chi_*]$ and recognizes that the temperature is due to the sum of the monopole and the gravitational potential.Carrying out the $\vec\theta$ integral leads to a delta function in $\vec k_\perp$, so that 
\begin{equation}
\tilde T^u(\vec l;\chi_*) = 
\frac{1}{\chi_*^2}\, \int \frac{dk_z}{2\pi}  [\tilde T_0+\tilde\Psi](\vec l/\chi_*,k_z)\,e^{ik_z\chi_*}\eql{tu}
\end{equation}
where the fact that $T^u$ depends on the distance to the last scattering surface is encoded in the argument on the left hand side.
This is important, as the temperature due to the time delay requires us to take the derivative with respect to $\chi_*$.

In particular,
\be
T^d(\vec\theta) = d(\vec\theta)\,\frac{\partial}{\partial\ln\chi_*}\, T^u(\vec\theta;\chi_*).
\ee
This is simply a Taylor expansion in the deviation from $\chi_*$ accounting for the fact that $d$ is the fractional change in the distance to the last scattering surface. In Fourier space, this becomes
\begin{equation}
\tilde T^d(\vec l) = \int \frac{d^2l'}{(2\pi)^2}\, \tilde d(\vec l') \tilde T^{u'}(\vec l-\vec l';\chi_*) % \int \frac{dk_z}{2\pi} \frac{k_z\chi_*}{\chi_*^2}\, [\tilde T_0+\tilde\Psi]([\vec l-\vec l_1]/\chi_*,k_z) \,e^{ik_z\chi_*}.
\eql{td}\end{equation}
where the prime on $T^u$ denote the  derivative with respect to $\ln\chi_*$. Comparing \ec{td} with \ec{tphi}  gives us a sense of the difficulty of extracting this signal. The contribution to the temperature due to deflection has two derivatives compared to the one due to time delay. These show up in Fourier space as extra factors of $\vec l'\cdot\vec l$, where $\vec l'$ is small (of order 50 for deflection, but $l\sim 10^3$. Even if the single derivative in the time delay case gives a factor of $k\chi_*\sim l$, the signal would still be down by a factor of order $l'\sim50$. Indeed, Figure 5 in \cite{Hu:2001yq} suggests that the power spectrum is down by a factor of $10^4$ implying that the RMS is down by 100. %A simpler way to compare the signals is to work in real space, so that the deflection signal is of order $\alpha/\theta\sim1'/

The derivative of $\tilde T^u$ nominally acts on three places in \ec{tu}: on the $\chi_*^{-2}$ out front, the logarithmic derivative is or order unity and similarly when it acts on the $\vec k_\perp$ argument of the temperature. When it acts on the exponential it is of order $k_z\chi_*$. Now $k_\perp\chi_*\sim l$; assuming $k_z$ is of the same order, the leading term in the derivative is the one that acts on the exponential, and we get
\begin{equation}
\tilde T^d(\vec l) = \chi_*\int \frac{d^2l'}{(2\pi)^2}\, \tilde d(\vec l')
\frac{i}{\chi_*^2}\, \int \frac{dk_z\,k_z}{2\pi}  [\tilde T_0+\tilde\Psi]([\vec l-\vec l']/\chi_*,k_z)\,e^{ik_z\chi_*}.
\end{equation}
Multiplying this by $\tilde T^u(\vec L)$ and taking the expectation value gives
\be
\int \frac{d^2l'}{(2\pi)^2}\, \tilde d(\vec l')
\frac{i}{\chi_*^2}\, \int \frac{dk_z\,k_z}{2\pi}  \,e^{ik_z\chi_*}
\frac{1}{\chi_*}\, \int \frac{dk'_z}{2\pi} \,e^{ik'_z\chi_*}
 \langle [\tilde T_0+\tilde\Psi]([\vec l-\vec l']/\chi_*,k_z)  [\tilde T_0+\tilde\Psi](\vec L/\chi_*,k'_z)\rangle
 \ee
 The 3 delta functions reduce this to
 \be
 \langle \tilde T^u(\vec L) \tilde T^d(\vec l) \rangle
 = \frac{i\tilde d(\vec l + \vec L)}{\chi_*} \int \frac{dk_z\,k_z}{2\pi} \, P_{T_o+\Psi}(L/\chi_*,k_z)
. \ee
 Redefining $\vec l + \vec L \rightarrow \vec L$ leads to an estimator\footnote{Not really; we need to include the $T^dT^u$ term as well}
 \be
 \hat{\tilde d}(\vec L) = -i \frac{\tilde T(\vec l-\vec L) \tilde T(\vec l)}{C'_{\vert\vec l-\vec L\vert}}
 \ee
 where
 \be
 C'_l \equiv  \frac{1}{\chi_*}\, \int \frac{dk_z\,k_z}{2\pi} \, P_{T_o+\Psi}(l/\chi_*,k_z)
 .\ee
If we wanted to construct the optimal estimator, we would sum these over all $\vec l$ with appropriate weighting.

Although this is a very rough derivation, we can already glimpse several points about the time delay estimator:
\begin{itemize}
\item Just like the deflection estimator, this will be a quadratic estimator pairing temperatures on small scales separated by a small Fourier space difference $\vec L$
\item Because Hu and Cooray showed that the time delay power spectrum peaks on the largest of scales, instead of $\Delta L\sim 50$ used for the deflection potential, here we will be using very small $\Delta L$'s, perhaps as small as 1. This means an all-sky treatment of the time delay field is essential.
\item While the deflection estimator upweights modes with small $\vec L\cdot \vec l$, i.e., it uses modes with lensing wavevector perpendicular to the anistropy wavevector, here there is no such angular preference. This should make it slightly easier to disentangle the two estimators.
\end{itemize}
\subsection{All-sky Expressions}

A starting point is 
%the set of equations 21 in \cite{knuthwebsite}. Their expressions are in terms of spherical harmonics so more complex than what we are looking for, but the two relevant terms are:
%\begin{eqnarray}
%T^\phi(\hat n) &=& \sum_{lm} I_m[j_l] \nabla_i\phi(\hat n) \nabla^i Y_l^m(\hat n)\\
%T^d(\hat n) &=& \sum_{lm} \frac{\partial a_{lm}(k\chi_*)}{(\partial k\chi_*)} d(\hat n)  Y_l^m(\hat n)\label{eq:ttd}
%\end{eqnarray}
\begin{equation}
T(\hat n) = \sum_{lm} Y_{lm}(\hat n) a_{lm}(\chi_*)
\end{equation}
where (Eq. (21) in ~\cite{Hu:2001bc})
\begin{equation}
a_{lm}(\chi_*) = (-i)^l \int \frac{d^3k}{(2\pi)^3}\, Y_{lm}^*(\hat k) [\tilde T_0+\tilde\Psi](\vec k;\eta_*) j_l(k\chi_*) \eql{alm}
\end{equation}
where $T_0$ is the monopole; $\Psi$ one of the scalar potentials; and $\chi_*$ the distance to the last scattering surface. 
Therefore, the small change due to the time delay is:
\begin{equation}
T^d(\hat n) = \sum_{lm} Y_{lm}(\hat n) \frac{\partial a_{lm}(\chi_*)}{\partial \chi_*} \chi_* d(\hat n)
\end{equation}
where $d$ is the fractional change in the distance to the last scattering surface as in \cite{Hu:2001yq}. We can go a step further using some of the formalism developed in \cite{Okamoto:2003zw} to express $d(\hat n)$ in terms of its spherical harmonics; then,
\begin{equation}
T^d(\hat n) = \sum_{LM;L'M'}\frac{\partial a_{LM}(\chi_*)}{\partial \ln\chi_*} d_{L'M'}  Y_{LM}(\hat n)  Y_{L'M'}(\hat n) .
\end{equation}
Writing this as
\begin{equation}
T^d(\hat n) = \sum_{lm} D_{lm}\,Y_{lm}(\hat n)  
\end{equation}
where -- to be clear -- $d_{lm}$ are the coefficients of the spherical harmonics of the time delay field while $D_{lm}$ are the coefficients of the contribution to the change in the CMB anisotropies due to this time delay. Multiplying by $Y^*_{lm}$ and integrating over $d\Omega_n$ leads to
\be
D_{lm} =\sum_{LM;L'M'}\frac{\partial a_{LM}(\chi_*)}{\partial \ln\chi_*} d_{L'M'}   \int d\Omega_{\hat n} Y_{LM}(\hat n)  Y_{L'M'}(\hat n)Y^*_{lm}(\hat n)  .
\ee
The integral can be done by using the formula for the product of spherical harmonics and then orthogonality leading to
\be
D_{lm} = \sum_{LM;L'M'}\frac{\partial a_{LM}(\chi_*)}{\partial \ln\chi_*} d_{L'M'}  I(lm;LM;L'M')
\ee
where 
\be
 I(lm;LM;L'M') = (-1)^m \left[ \frac{(2L+1)(2L'+1)(2l+1)}{4\pi}\right]^{1/2}\left(\begin{matrix} l & L &L'\cr 0&0&0\end{matrix}\right)
 \left(\begin{matrix} l & L &L'\cr -m&M&M'\end{matrix}\right).
\ee

\section{Estimators}

The observed temperature field has coefficients
\be
a^{\rm obs}_{lm} = a_{lm} + D_{lm}
.\ee
When we take quadratic estimators the perturbative term will have an expectation value:
\be
\langle a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2} \rangle= \delta_{l_1l_2}\delta_{m_1-m_2}C_{l_1} + \langle a_{l_1m_1}D_{l_2m_2}\rangle+ \langle a_{l_2m_2}D_{l_1m_1}\rangle
.\eql{terms}
\ee
Consider the middle term here and use \ec{alm} to get
\bea
\langle a_{l_1m_1}D_{l_2m_2}\rangle&=&\sum_{LM;L'M'}d_{L'M'}  I(l_2m_2;LM;L'M')
 (-i)^{l_1+L} \int \frac{d^3k}{(2\pi)^3}\, Y_{l_1m_1}^*(\hat k) j_{l_1}(k\chi_*)\,
 \int \frac{d^3k'}{(2\pi)^3}\, Y_{LM}^*(\hat k') \frac{\partial j_L(k'\chi_*)}{\partial\ln(\chi_*)}
\vs
&&\times\langle  [\tilde T_0+\tilde\Psi](\vec k;\eta_*)  [\tilde T_0+\tilde\Psi](\vec k';\eta_*) \rangle.
\eea
But the expectation value leads to the 3D power spectrum multiplied by a delta function in $\vec k+\vec k'$, after which the angular integral over the spherical harmonics can be performed using ($Y_{LM}^*(-\hat k)=(-1)^{L+M}Y_{L,-M}(\hat k)$, and we are left with
\be
\langle a_{l_1m_1}D_{l_2m_2}\rangle=\sum_{L'M'}d_{L'M'}  I(l_2m_2;l_1,-m_1;L'M')
 (-1)^{m_1} \int \frac{dk k^2}{(2\pi)^3}\, j_{l_1}(k\chi_*)\,\frac{\partial j_{l_1}(k\chi_*)}{\partial\ln(\chi_*)}P_{T_0+\Psi}(k).
\ee
The last term in \ec{terms} simply has $l_1,m_1\leftrightarrow l_2,m_2$ so the full off-diagonal expression for the expectation value is
\bea
\langle a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2} \rangle\Big\vert_{\rm off-diagonal} &=&
\sum_{L'M'}d_{L'M'}  
 \vs
\times &&
 \left[
 I(l_2m_2;l_1,-m_1;L'M')
 (-1)^{m_1} C^{(1)}_{l_1}
  + 
 I(l_1m_1;l_2,-m_2;L'M')
 (-1)^{m_2}C^{(1)}_{l_2}
 \right]\eea
where
\be
C^{(1)}_{l}\equiv \int \frac{dk k^2}{(2\pi)^3}\, j_{l}(k\chi_*)\,\frac{\partial j_{l}(k\chi_*)}{\partial\ln(\chi_*)}P_{T_0+\Psi}(k).
\ee

We can use the identity (Eq 31 in ~\cite{Okamoto:2003zw})
\be
\sum_{m_1m_2} 
 \left(\begin{matrix} l_2 & l_1 &L'\cr -m_2&m_1&M'\end{matrix}\right)
 \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&m_1&M\end{matrix}\right)
=\frac{1}{2L+1}\,\delta_{LL'}\delta_{MM}
\ee
so that multiplying by $(-1)^{m_1+m_2} \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)$ and summing over $m_1,m_2$ leads to
\be
\sum_{m_1m_2}  (-1)^{m_1+m_2} \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right) 
I(l_2m_2;l_1,-m_1;L'M')
 (-1)^{m_1} 
= \left[
\frac{(2l_1+1)(2l_2+1)}{4\pi (2L+1)}\right]^{1/2}\delta_{LL'}\delta_{MM'}\left(\begin{matrix} l_2 & l_1 &L\cr 0&0&0\end{matrix}\right)
.\ee
The same operation on the second term is trickier:
\bea
\sum_{m_1m_2}  (-1)^{m_1+m_2} &&\left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right) 
I(l_1m_1;l_2,-m_2;L'M')
 (-1)^{m_2}
 =
 \sum_{m_1m_2}   \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right) 
 \vs
 &&\times\left[ \frac{(2l_1+1)(2L'+1)(2l_2+1)}{4\pi}\right]^{1/2}\left(\begin{matrix} l_1 & l_2 &L'\cr 0&0&0\end{matrix}\right) 
 \left(\begin{matrix} l_1 & l_2 &L'\cr -m_1&-m_2&M'\end{matrix}\right).
 \eea
Switching columns in the Wigner 3j symbol brings in a factor of $(-1)^{l_1+l_2+L'}$ so
\bea
\sum_{m_1m_2}  (-1)^{m_1+m_2} &&\left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right) 
I(l_1m_1;l_2,-m_2;L'M')
 (-1)^{m_2}
 =
 (-1)^{l_1+l_2+L'}  
 \vs
 &&\times\left[
\frac{(2l_1+1)(2l_2+1)}{4\pi (2L+1)}\right]^{1/2}\delta_{LL'}\delta_{MM'}\left(\begin{matrix} l_2 & l_1 &L\cr 0&0&0\end{matrix}\right).
 \eea
Therefore,
\bea
\sum_{m_1m_2}  (-1)^{m_1+m_2} &&\left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)
\langle a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2} \rangle\Big\vert_{\rm off-diagonal}
\vs
&=& d_{LM} \left[ \frac{(2l_1+1)(2L'+1)(2l_2+1)}{4\pi}\right]^{1/2}\left(\begin{matrix} l_1 & l_2 &L'\cr 0&0&0\end{matrix}\right)
\left[ C^{(1)}_{l_1} + (-1)^{l_1+l_2+L}C^{(1)}_{l_2}\right]
\eea


Therefore, an intermediate estimator for the time delay field is
\be
\hat d_{LM}(l_1l_2) =  \sum_{m_1m_2}  (-1)^{m_1+m_2}\,\left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)
 a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2} 
 \ee
 where the expectation value is
 \be
\langle \hat d_{LM}(l_1l_2) \rangle = f_{l_1l_2L} \equiv 
 \left[ \frac{(2l_1+1)(2l_2+1)}{4\pi (2L+1)}\right]^{1/2}
 \Big[
 \left(\begin{matrix} l_2& l_1 &L\cr 0&0&0\end{matrix}\right)
  \Big]
  \left[ C^{(1)}_{l_1} + (-1)^{l_1+l_2+L}C^{(1)}_{l_2}\right]
 .\ee
 
 This is for a fixed value of $l_1, l_2$; we want to sum over all possible values with a weighting fixed so that the variance is as small as possible. Define the weighting factor as $g_{l_1l_2}(L)$; then,
 \be
 \hat d_{LM} = \mathcal{A}_{LM}\sum_{l_1l_2} g_{l_1l_2}(L) \sum_{m_1m_2}  (-1)^{m_1+m_2}\,\left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)
 a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2} 
 \ee
 where to get the expectation right
 \be
 \mathcal{A}_{LM} \equiv \left[ \sum_{l_1l_2} g_{l_1l_2}(L) f_{l_1l_2L}\right]^{-1}
 .\ee
 
 \subsection{Variance}
 
 We want to choose the coefficients $g$ to maximize the signal to noise, so we need to first compute the variance:
 \bea
 \langle d_{LM} d^*_{L'M'} \rangle &=& (-1)^{M+M'}  \mathcal{A}_{LM}\mathcal{A}^*_{L'M'} \sum_{l_1l_2m_1m_2 l_1'l_2'm_1'm_2'} g_{l_1l_2}(L)  g^*_{l_1'l_2'}(L') \vs
 &&\times \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)
 \left(\begin{matrix} l_2' & l_1' &L'\cr -m_2'&-m_1'&M'\end{matrix}\right)^*
 \langle a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2}  a^{*,\rm obs}_{l_1'm_1'} a^{*,\rm obs}_{l_2'm_2'} \rangle.
 \eea
 Here we used the fact that $m_1+m_2=-M$ because of the Wigner 3j symbol. In the expectation value, we can consider only the dominant unlensed contribution, which is Gaussian, so that the 4-point function would has 3 terms, corresponding to the 3 contractions. One of these sets $m_1=-m_2$ (and similarly for $m_i'$) so that the Wigner 3j symbols require $M=M'=0$. The other 2 set, e.g., $m_1=m_1'$ so eliminate the sums over the primed indices, leading to a diagonal variance of
 \bea
 \langle d_{LM} d^*_{LM} \rangle &=& \vert \mathcal{A}_{LM}\vert^2
 \sum_{l_1m_1} C_{l_1}
 \vs
 &&\times 
\Bigg[ \sum_{ l_1'm_1'}  C_{l_1'} g_{l_1l_1}(L)  g^*_{l_1'l_1'}(L) 
\times \left(\begin{matrix} l_1 & l_1 &L\cr m_1&-m_1&M\end{matrix}\right)
 \left(\begin{matrix} l_1' & l_1' &L\cr m_1'&-m_1'&M\end{matrix}\right)^*\vs
 &&+ \sum_{l_2m_2}  C_{l_2}  g_{l_1l_2}(L)  g^*_{l_1l_2}(L)  \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)
 \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)^* 
 \vs
 &&+ \sum_{l_2m_2}  C_{l_2} g_{l_1l_2}(L)  g^*_{l_2l_1}(L)  \left(\begin{matrix} l_2 & l_1 &L\cr -m_2&-m_1&M\end{matrix}\right)
 \left(\begin{matrix} l_1 & l_2 &L\cr -m_1&-m_2&M\end{matrix}\right)^* 
 \Bigg].
  \eea 
  The sum of the $m$'s in the second row of the Wigner 3j symbols must be zero. In the first pair, this means that $M$ must be equal to zero. On the second and third, the sum over $m_2$ can be removed, leaving
  \bea
 \langle d_{LM} d^*_{LM} \rangle &=& \vert \mathcal{A}_{LM}\vert^2
 \sum_{l_1m_1} C_{l_1}
 \vs
 &&\times 
\Bigg[ \delta_{M0}\sum_{ l_1'm_1'}  C_{l_1'} g_{l_1l_1}(L)  g^*_{l_1'l_1'}(L) 
\times \left(\begin{matrix} l_1 & l_1 &L\cr m_1&-m_1&0\end{matrix}\right)
 \left(\begin{matrix} l_1' & l_1' &L\cr m_1'&-m_1'&0\end{matrix}\right)^*\vs
 &&+ \sum_{l_2}  C_{l_2}  \bigg( g_{l_1l_2}(L)  g^*_{l_1l_2}(L)  \left(\begin{matrix} l_2 & l_1 &L\cr m_1-M&-m_1&M\end{matrix}\right)
 \left(\begin{matrix} l_2 & l_1 &L\cr m_1-M&-m_1&M\end{matrix}\right)^* 
 \vs
 &&+ g_{l_1l_2}(L)  g^*_{l_2l_1}(L)  \left(\begin{matrix} l_2 & l_1 &L\cr m_1-M&-m_1&M\end{matrix}\right)
 \left(\begin{matrix} l_1 & l_2 &L\cr -m_1&m_1-M&M\end{matrix}\right)^* 
\bigg) \Bigg].
  \eea 
An odd permutation of columns brings in a phase factor of $(-1)^{l_1+l_2+L}$ so the 3j symbols on the last line are related to those on the first line by this factor and $l'$ on the third line can be replaced by $l_2$:
 \bea
 \langle d_{LM} d^*_{LM} \rangle &=& \vert \mathcal{A}_{LM}\vert^2
 \sum_{l_1m_1l_2} C_{l_1} C_{l_2}  
 \vs
 &\times &
\Bigg[ \delta_{M0}\sum_{ m_1'}  g_{l_1l_1}(L)  g^*_{l_2l_2}(L) 
\times \left(\begin{matrix} l_1 & l_1 &L\cr m_1&-m_1&0\end{matrix}\right)
 \left(\begin{matrix} l_2& l_2 &L\cr m_1'&-m_1'&0\end{matrix}\right)^*\vs
 &&+ g_{l_1l_2}(L)  \bigg\vert\left(\begin{matrix} l_2 & l_1 &L\cr m_1-M&-m_1&M\end{matrix}\right)\bigg\vert^2
  \left( g^*_{l_1l_2}(L)  + (-1)^{l_1+l_2+L}g^*_{l_2l_1}(L) \right)
  \Bigg].
  \eea 

Before minimizing, let's put this in a more compact form:
\be  
  \langle d_{LM} d^*_{LM} \rangle 
  = \vert \mathcal{A}_{LM}\vert^2 \sum_{l_1l_2}
  \left[ \delta_{M0} g_{l_1l_1}(L)  g^*_{l_2l_2}(L) I(l_1,l_2,L)
  + g_{l_1l_2}(L)   \left( g^*_{l_1l_2}(L)  + (-1)^{l_1+l_2+L}g^*_{l_2l_1}(L) \right) J(l_2,l_1,L,M)
  \right]
 \ee 
 with
 \bea
 I(l_1,l_2,L) &\equiv& \sum_{m_1m'} \left(\begin{matrix} l_1 & l_1 &L\cr m_1&-m_1&0\end{matrix}\right)
 \left(\begin{matrix} l_2& l_2 &L\cr m_1'&-m_1'&0\end{matrix}\right)^*
 \vs
 J(l_2,l_1,L,M) &\equiv&\sum_{m_1} \bigg\vert\left(\begin{matrix} l_2 & l_1 &L\cr m_1-M&-m_1&M\end{matrix}\right)\bigg\vert^2
 .\eea
 
\bibliography{refs}
\end{document}

 \subsection{Comparison with Deflection estimator}
 
 It is interesting to compare this estimator with that obtained for the deflection angle at this stage in the calculation in \citet{Okamoto:2003zw}. Paraphrasing Eq (29) there leads to
 \be
 \hat\alpha_{LM} = \frac{A_L}{\sqrt{L(L+1}}\,\sum_{l_1,m_1,l_2m_2}
 (-1)^M \left(\begin{matrix} l_1& l_2 &L\cr m_1&m_2&-M \end{matrix}\right)
 g_{l_1l_2}
 a^{\rm obs}_{l_1m_1} a^{\rm obs}_{l_2m_2} 
 \ee
 where
 
 \be
 A_L \equiv L(L+1)(2L+1) \left[ \sum_{l_1l_2} g_{l_1l_2} f_{l_1Ll_2}\right]^{-1}
 \ee

